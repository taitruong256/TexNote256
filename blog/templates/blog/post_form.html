{% extends 'base.html' %}
{% block content %}
<div class="container-fluid px-2">
  <form method="post" id="postForm">
    {% csrf_token %}
    <div class="mb-2">
      <label for="id_title" class="form-label fw-semibold">Tiêu đề</label>
      <input type="text" name="title" maxlength="5000" class="form-control form-control-lg" id="id_title" required>
    </div>
    <div class="row g-2">
      <div class="col-md-6 col-12">
        <label for="id_content" class="form-label fw-semibold">Nội dung LaTeX</label>
        <textarea name="content" cols="40" rows="15" class="form-control latex-editor" id="id_content" required style="min-height:320px;"></textarea>
        <div class="form-text">Soạn thảo bằng LaTeX, hỗ trợ công thức toán học.</div>
      </div>
      <div class="col-md-6 col-12">
        <label class="form-label fw-semibold">Xem trước nội dung (HTML)</label>
        <div id="latexPreview" class="p-2 bg-white border rounded shadow-sm" style="min-height:320px;"></div>
      </div>
    </div>
    <div class="mt-3">
      <button type="submit" class="btn btn-success px-4">Đăng bài</button>
      <a href="/" class="btn btn-secondary px-4">Hủy</a>
    </div>
  </form>
</div>
<script>
function renderLatexPreview() {
  const latex = document.querySelector('#id_content').value;
  fetch('{% url 'latex_render_html' %}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'X-CSRFToken': '{{ csrf_token }}'
    },
    body: 'latex=' + encodeURIComponent(latex)
  })
  .then(res => res.json())
  .then(data => {
    document.querySelector('#latexPreview').innerHTML = data.html;
  });
}
document.querySelector('#id_content').addEventListener('input', renderLatexPreview);
document.addEventListener('DOMContentLoaded', renderLatexPreview);
</script>
<style>
.latex-editor {
  font-family: 'Fira Mono', 'Consolas', monospace;
  font-size: 1.08rem;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #ced4da;
  padding: 0.7rem;
  min-height: 320px;
}
#latexPreview {
  min-height: 320px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #ced4da;
  padding: 0.7rem;
}
@media (max-width: 767px) {
  .col-md-6 { width: 100%; }
}
</style>
{% endblock %}
