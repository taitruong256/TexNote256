{% extends 'base.html' %}
{% block content %}
<div class="container-fluid px-2">
  <form method="post" id="postForm">
    {% csrf_token %}
    <div class="mb-2">
      <label for="id_title" class="form-label fw-semibold" style="font-size:1.1rem;">Tiêu đề</label>
      <input type="text" name="title" maxlength="5000" class="form-control form-control-sm" id="id_title" required value="{{ form.title.value|default_if_none:'' }}" style="font-size:1.05rem; padding:0.4rem 0.7rem;">
    </div>
    <div class="row g-2">
      <div class="col-md-6 col-12">
        <label for="id_content" class="form-label fw-semibold" style="font-size:1.1rem;">Nội dung LaTeX</label>
        <textarea name="content" cols="40" rows="15" class="form-control latex-editor" id="id_content" required style="min-height:320px; max-height:60vh; height:60vh; resize:vertical; overflow:auto; font-size:1.05rem;"></textarea>
        <div class="form-text">Soạn thảo bằng LaTeX, hỗ trợ công thức toán học.</div>
      </div>
      <div class="col-md-6 col-12">
        <label class="form-label fw-semibold" style="font-size:1.1rem;">Xem trước nội dung (HTML)</label>
        <div id="latexPreview" class="form-control bg-white border rounded shadow-sm" style="min-height:320px; max-height:60vh; height:60vh; overflow:auto;"></div>
      </div>
    </div>
    <div class="mt-3 d-flex flex-wrap align-items-center gap-2">
      <button type="submit" class="btn btn-success px-4">{% if edit_mode %}Lưu thay đổi{% else %}Đăng bài{% endif %}</button>
      <a href="{% if edit_mode %}{% url 'post_detail' post.id %}{% else %}/{% endif %}" class="btn btn-secondary px-4">Hủy</a>
    </div>
  </form>
</div>
<script>
function renderLatexPreview() {
  const latex = document.querySelector('#id_content').value;
  fetch('{% url 'latex_render_html' %}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'X-CSRFToken': '{{ csrf_token }}'
    },
    body: 'latex=' + encodeURIComponent(latex)
  })
  .then(res => res.json())
  .then(data => {
    document.querySelector('#latexPreview').innerHTML = data.html;
  });
}
document.querySelector('#id_content').addEventListener('input', renderLatexPreview);
document.addEventListener('DOMContentLoaded', renderLatexPreview);
</script>
<style>
.latex-editor {
  font-family: 'Fira Mono', 'Consolas', monospace;
  font-size: 1.05rem;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #ced4da;
  padding: 0.7rem;
  min-height: 320px;
  max-height: 60vh;
  height: 60vh;
  resize: vertical;
  overflow: auto;
}
#latexPreview {
  min-height: 320px;
  max-height: 60vh;
  height: 60vh;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #ced4da;
  padding: 0.7rem;
}
@media (max-width: 767px) {
  .col-md-6 { width: 100%; }
  #latexPreview, .latex-editor { max-height: 40vh; height: 40vh; }
}
</style>
{% endblock %}
